<div class="articles-container">
  <div class="toolbar">
    <div class="left">
      <label>
        Mostrar:
        <select [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
          <option *ngFor="let s of pageSizes" [ngValue]="s">{{ s }}</option>
        </select>
        por página
      </label>
    </div>
    <div class="right">
      <span *ngIf="loading">Cargando...</span>
      <span *ngIf="!loading">{{ totalCount }} artículos</span>
    </div>
  </div>

  <div class="card-grid">
    <div class="card" *ngFor="let a of articles">
      <div class="card-image">
        <img
          *ngIf="imageSrc(a)"
          [src]="imageSrc(a)"
          [alt]="a.descripcion || a.codigo || 'Artículo'"
        />
        <div *ngIf="!imageSrc(a)" class="no-image">Sin imagen</div>
      </div>

      <div class="card-body">
        <h3 class="card-title">{{ a.descripcion || a.name }}</h3>
        <p class="card-code" *ngIf="a.codigo">Código: {{ a.codigo }}</p>
        <p class="card-stock" [class.out]="(a.stock ?? 0) <= 0">Stock: {{ a.stock ?? 0 }}</p>
        <p class="card-price">{{ formatPrice(a.precio) }}</p>

        <!-- Acciones del carrito -->
        <div class="card-actions">
          <ng-container *ngIf="getCartQty(a) > 0; else showAdd">
            <div class="d-flex align-items-center gap-2">
              <!-- Grupo de botones para cantidad -->
              <div class="btn-group btn-group-sm" role="group" aria-label="Cantidad">
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  (click)="decreaseQty(a)"
                  aria-label="Disminuir"
                >
                  −
                </button>

                <!-- Mostrar cantidad como control no editable -->
                <span class="btn btn-light disabled px-3">{{ getCartQty(a) }}</span>

                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  (click)="increaseQty(a)"
                  aria-label="Aumentar"
                >
                  +
                </button>
              </div>

              <!-- Botón eliminar -->
              <button type="button" class="btn btn-sm btn-danger ms-2" (click)="removeFromCart(a)">
                Eliminar
              </button>
            </div>
          </ng-container>

          <ng-template #showAdd>
            <!-- Botón principal de agregar -->
            <button type="button" class="btn btn-primary btn-sm w-100" (click)="addToCart(a)">
              <i class="bi bi-cart-plus me-1" aria-hidden="true"></i> Agregar al carrito
            </button>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- Paginador -->
  <nav class="paginator" *ngIf="totalPages > 1">
    <button (click)="prevPage()" [disabled]="page === 1">Prev</button>

    <button
      *ngFor="let _ of pages; let i = index"
      (click)="goToPage(i + 1)"
      [class.active]="page === i + 1"
    >
      {{ i + 1 }}
    </button>

    <button (click)="nextPage()" [disabled]="page === totalPages">Next</button>
  </nav>
</div>
